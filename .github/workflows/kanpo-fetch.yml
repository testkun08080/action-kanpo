name: æ¯æ—¥å®˜å ±ç™ºè¡Œãƒã‚§ãƒƒã‚«ãƒ¼

on:
  schedule:
    - cron: "45 23 * * *" # æ¯æ—¥8:45 JST
  workflow_dispatch:

jobs:
  fetch-kanpo:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: å®˜å ±ãƒã‚§ãƒƒã‚¯(DLç„¡ã—)
        id: fetch-kanpo-step
        uses: testkun08080/action-kanpo@main
        with:
          dlpdf: "false" # PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãªã„
          date: "2025-07-03"
      - name: å®˜å ±ãƒã‚§ãƒƒã‚¯çµæœã‚’å‡ºåŠ›
        id: output-fettch-kanpo-step
        run: |
          echo "kanpou_found=${{ steps.fetch-kanpo-step.outputs.kanpou_found }}"
          echo "pdf_infos=${{ steps.fetch-kanpo-step.outputs.pdf_infos }}"

    outputs:
      kanpou_found: ${{ steps.fetch-kanpo-step.outputs.kanpou_found }}
      pdf_infos: ${{ steps.fetch-kanpo-step.outputs.pdf_infos }}

  show-results:
    needs: fetch-kanpo
    runs-on: ubuntu-latest
    steps:
      - name: çµæœã‚’è¡¨ç¤º
        run: |
          echo "å®˜å ±å–å¾—æˆåŠŸ or å¤±æ•—: ${{needs.fetch-kanpo.outputs.kanpou_found}}"
          echo "å–å¾—PDFæ•°: ${{needs.fetch-kanpo.outputs.pdf_infos}}"

  fetch-dl-kanpo:
    needs: fetch-kanpo
    if: needs.fetch-kanpo.outputs.kanpou_found == 'true'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã®å¾…æ©Ÿ
        run: |
          echo "âŒ› 5ç§’å¾…æ©Ÿä¸­..."
          sleep 5

      - name: å®˜å ±ãƒã‚§ãƒƒã‚¯(DLã‚ã‚Š)
        id: fetch-dl-kanpo-step
        uses: testkun08080/action-kanpo@main
        with:
          dlpdf: "true" # PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
          date: "2025-07-03"
      - name: å®˜å ±ãƒã‚§ãƒƒã‚¯çµæœã‚’å‡ºåŠ›
        id: output-fetch-dl-kanpo-step
        run: |
          echo "kanpou_found=${{ steps.fetch-dl-kanpo-step.outputs.kanpou_found }}"
          echo "pdf_infos=${{ steps.fetch-dl-kanpo-step.outputs.pdf_infos }}"

  commit:
    name: å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
    runs-on: ubuntu-latest
    needs: fetch-dl-kanpo
    if: success()
    steps:
      - uses: actions/checkout@v4

      - name: kanpo ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆãƒ„ãƒªãƒ¼å½¢å¼ï¼‰è¡¨ç¤º
        run: |
          apt-get update && apt-get install -y tree
          if [ -d kanpo ]; then
            tree -a kanpo
          else
            echo "âš ï¸ kanpo ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          fi

      - name: Git è¨­å®šã¨ã‚³ãƒŸãƒƒãƒˆ
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          if git diff --staged --quiet; then
            echo "ğŸ“­ å¤‰æ›´ãªã—ï¼ˆæ–°ã—ã„å®˜å ±ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰"
          else
            git commit -m "å®˜å ±æ›´æ–°: $(date '+%Y-%m-%d')"
            git push

  # tweet:
  #   name: ãƒ„ã‚¤ãƒ¼ãƒˆé€ä¿¡
  #   needs: test
  #   if: success()
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: noweh/post-tweet-v2-action@v1.0
  #       with:
  #         message: "ä»Šæ—¥ã®å®˜å ±ï¼æœ€æ–°ã®å®˜å ±ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚ #å®˜å ±"
  #         consumer-key: ${{ secrets.TWITTER_CONSUMER_KEY }}
  #         consumer-secret: ${{ secrets.TWITTER_CONSUMER_SECRET }}
  #         access-token: ${{ secrets.TWITTER_ACCESS_TOKEN }}
  #         access-token-secret: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
